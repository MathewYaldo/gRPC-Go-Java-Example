## Introduction
This repository provides a basic demo of a Go application sending a request to a Java application and receiving a response back with gRPC.

## Prerequisites
  1. Install Protobuf with `brew install protobuf`
  2. Install the latest Go Protobuf plugins:
````bash
go install google.golang.org/protobuf/cmd/protoc-gen-go@latest
go install google.golang.org/grpc/cmd/protoc-gen-go-grpc@latest
````

## Part 1 - Java project configuration
1. Create a new Java project using Gradle (maven works too)
2. Visit https://github.com/grpc/grpc-java and add the ***non-Android*** dependencies displayed in the README to your build.gradle file.
3. Add the ***non-Android*** `protobuf-gradle-plugin`  plugin declaration along with the Protobuf block.
4. In the `src/main` directory, create a new directory called `Proto` and add all .proto files here. Note that the files must be in this exact location.
5. Ensure that the .proto files have  `option java_multiple_files = true;`  and `option java_package = "org.example";` Replace `org.example` with the Java package that will be using the service
6. Run `./gradlew` to make the autogenerated files. Generated files will be under `build/generated/proto/main`
7. For each service *Serv*, create a class extending ServGrpc.ServImplBase. Example: `public class HashServiceImpl extends HashGrpc.HashImplBase`
8. Within the class, override all the functions that belong to the service. Example:
````java
@Override  
public void getHash(HashRequest request, io.grpc.stub.StreamObserver<HashResponse> responseObserver) {
// Perform work here
String hash = ComputeHash();
...
HashResponse response = HashResponse  
        .newBuilder()  
        .setHash(hash)  
        .build();  
  
responseObserver.onNext(response);  
responseObserver.onCompleted();
}
````
 
See the repo files for a full example along with the code for starting up the gRPC server.

## Part 2 - Go project configuration
1. Create a proto folder and add all the .proto files there. Remove the java headers and add `option go_package = "/grpc";`
2. Create the autogenerated Go files with the following command replacing hash.proto with the proper proto file(s): `protoc --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative ./hash.proto`

See example Go code for how to send the request.


## How to build and run demo projects

For Java, run `./gradlew fatJar` and `java -jar build/libs/gRPCTests-1.0-SNAPSHOT.jar`

For Go, run `go mod download` to get the dependencies and run `go build` afterwards. The program can then be launched by executing the binary. Ex: `./gRPCGo`

For the Java project, the generated files are not hosted in this repository, but will show up after running the `./gradlew fatJar` command. `./gradlew build` can also be used.

Sources:
- https://intuting.medium.com/implement-grpc-service-using-java-gradle-7a54258b60b8
- https://github.com/grpc/grpc-java
- https://www.jetbrains.com/guide/go/tutorials/grpc_part_one/grpc_in_go/
- https://brunoscheufler.com/blog/2021-08-27-communicating-between-java-and-go-using-grpc
